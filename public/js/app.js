function addEventListeners(){let e=document.querySelectorAll("button.banUser");[].forEach.call(e,function(e){e.addEventListener("click",sendBanUserRequest)});let t=document.querySelectorAll("button.addToCart");[].forEach.call(t,function(e){e.addEventListener("click",sendAddToCartRequest)});let s=document.querySelectorAll("i.addToCartHome");[].forEach.call(s,function(e){e.addEventListener("click",sendAddToCartHomeRequest)});let a=document.querySelectorAll("button.addToCartGame");[].forEach.call(a,function(e){e.addEventListener("click",sendAddToCartGameRequest)});let n=document.querySelectorAll("button.removeFromCart");[].forEach.call(n,function(e){e.addEventListener("click",sendRemoveFromCartRequest)});let r=document.querySelectorAll("i.addToFavoritesHome");[].forEach.call(r,function(e){e.addEventListener("click",sendAddToFavoritesHomeRequest)});let o=document.querySelectorAll("button.addToFavoritesGame");[].forEach.call(o,function(e){e.addEventListener("click",sendAddToFavoritesGameRequest)});let i=document.querySelectorAll("button.removeFromFavorites");[].forEach.call(i,function(e){e.addEventListener("click",sendRemoveFromFavoritesRequest)});let l=document.querySelectorAll("button.removeFromFavoritesGame");[].forEach.call(l,function(e){e.addEventListener("click",sendRemoveFromFavoritesGameRequest)});let c=document.querySelectorAll("button.deleteGameRequest");[].forEach.call(c,function(e){e.addEventListener("click",sendDeleteGameRequest)});let d=document.querySelectorAll("button.loadReviews");[].forEach.call(d,function(e){e.addEventListener("click",sendLoadReviewsRequest)});let u=document.querySelectorAll("button.addReview");[].forEach.call(u,function(e){e.addEventListener("click",addReviewForm)});let m=document.querySelectorAll("button.upvote");[].forEach.call(m,function(e){e.addEventListener("click",sendUpvoteReviewRequest)});let v=document.querySelectorAll("button.downvote");[].forEach.call(v,function(e){e.addEventListener("click",sendDownvoteReviewRequest)})}function encodeForAjax(e){return null==e?null:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function sendAjaxRequest(e,t,s,a){let n=new XMLHttpRequest;n.open(e,t,!0),n.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="csrf-token"]').content),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.addEventListener("load",a),n.send(encodeForAjax(s))}function sendBanUserRequest(e){sendAjaxRequest("post","/api/admin/users/"+this.parentNode.parentNode.querySelector("div.username").textContent.trim(),null,banUserHandler)}function banUserHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e=JSON.parse(this.responseText),t=document.querySelector('div.list_element[data-id="'+e.username+'"] div.col-sm-9 div.row div.ban'),s=document.createElement("div");s.classList.add("col-sm-2"),s.classList.add("px-0"),s.classList.add("colored"),s.classList.add("justify-content-start"),s.classList.add("d-flex"),s.classList.add("align-items-center"),s.classList.add("rounded-right"),s.innerHTML='<div class="col-sm-6 alert alert-success mb-0"><span<strong>Banned</strong></span></div>',t.parentNode.replaceChild(s,t)}function sendAddToCartRequest(e){let t=this.nextSibling.value,s=this.nextSibling.nextSibling.value;sendAjaxRequest("post","/api/users/"+t.trim()+"/cart/"+s.trim(),null,addToCartHandler)}function addToCartHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e,t=document.querySelectorAll("input[name=game]");for(var s=0;s<t.length;s++)if(t[s].value==JSON.parse(this.responseText)){e=t[s];break}let a=e.previousSibling.previousSibling,n=a.parentNode,r=document.createElement("div");r.classList.add("alert"),r.classList.add("alert-success"),r.innerHTML="<span><strong>Success!</strong></span>",n.replaceChild(r,a)}function sendAddToCartHomeRequest(e){let t=this.nextSibling.value,s=this.nextSibling.nextSibling.value;sendAjaxRequest("post","/api/users/"+t.trim()+"/cart/"+s.trim(),null,addToCartHomeHandler)}function addToCartHomeHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e,t=document.querySelectorAll("input[name=game]");for(var s=0;s<t.length;s++)if(t[s].value==JSON.parse(this.responseText)){e=t[s];break}let a=e.previousSibling.previousSibling.parentNode.parentNode.parentNode,n=document.createElement("div");n.classList.add("alert"),n.classList.add("alert-success"),n.innerHTML="<span><strong>Success!</strong></span>",a.appendChild(n)}function sendAddToCartGameRequest(e){let t=document.querySelector("input[name=username]").value,s=document.querySelector("input[name=game]").value;sendAjaxRequest("post","/api/users/"+t.trim()+"/cart/"+s.trim(),null,addToCartGameHandler)}function addToCartGameHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e=document.querySelector("button.addToCartGame"),t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-success"),t.classList.add("d-flex"),t.classList.add("justify-content-center"),t.innerHTML="<span><strong>Success!</strong></span>",e.parentNode.replaceChild(t,e)}function sendAddToFavoritesHomeRequest(e){let t=this.previousSibling.previousSibling.value,s=this.previousSibling.value;sendAjaxRequest("post","/api/users/"+t.trim()+"/favorites/"+s.trim(),null,addToFavoritesHomeHandler)}function addToFavoritesHomeHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e,t=document.querySelectorAll("input[name=game]");for(var s=0;s<t.length;s++)if(t[s].value==JSON.parse(this.responseText)){e=t[s];break}let a=e.nextSibling.parentNode.parentNode.parentNode,n=document.createElement("div");n.classList.add("alert"),n.classList.add("alert-success"),n.innerHTML="<span><strong>Success!</strong></span>",a.appendChild(n)}function sendAddToFavoritesGameRequest(e){let t=document.querySelector("input[name=username]").value,s=document.querySelector("input[name=game]").value;sendAjaxRequest("post","/api/users/"+t.trim()+"/favorites/"+s.trim(),null,addToFavoritesGameHandler)}function addToFavoritesGameHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e=document.querySelector("button.addToFavoritesGame"),t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-success"),t.classList.add("d-flex"),t.classList.add("justify-content-center"),t.innerHTML="<span><strong>Success!</strong></span>",e.parentNode.replaceChild(t,e)}function sendRemoveFromFavoritesRequest(){let e=this.previousSibling.previousSibling.value,t=this.previousSibling.value;sendAjaxRequest("delete","/api/users/"+e.trim()+"/favorites/"+t.trim(),null,removeFromFavoritesHandler)}function removeFromFavoritesHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e,t=document.querySelectorAll("input[name=game]");for(var s=0;s<t.length;s++)if(t[s].value==JSON.parse(this.responseText)){e=t[s];break}e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode)}function sendRemoveFromFavoritesGameRequest(){let e=document.querySelector("input[name=username]").value,t=document.querySelector("input[name=game]").value;sendAjaxRequest("delete","/api/users/"+e.trim()+"/favorites/"+t.trim(),null,removeFromFavoritesGameHandler)}function removeFromFavoritesGameHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e=document.querySelector("button.removeFromFavoritesGame"),t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-success"),t.classList.add("d-flex"),t.classList.add("justify-content-center"),t.innerHTML="<span><strong>Success!</strong></span>",e.parentNode.replaceChild(t,e)}function sendRemoveFromCartRequest(){let e=this.previousSibling.previousSibling.value,t=this.previousSibling.value;sendAjaxRequest("delete","/api/users/"+e.trim()+"/cart/"+t.trim(),null,removeFromCartHandler)}function removeFromCartHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e,t=JSON.parse(this.responseText),s=document.querySelectorAll("input[name=game]");for(var a=0;a<s.length;a++)if(s[a].value==t.game){e=s[a];break}e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode),document.querySelector("div.checkout-zone div div h6 strong").innerHTML="Total: "+t.sum_prices.toFixed(2)}function sendDeleteGameRequest(){let e=this.previousSibling.previousSibling.value,t=this.previousSibling.value;sendAjaxRequest("delete","/api/users/"+e.trim()+"/sell/"+t.trim(),null,deleteGameRequestHandler)}function deleteGameRequestHandler(){if(200!=this.status)return void showErrorMessage(this.status);JSON.parse(this.responseText);let e,t=document.querySelectorAll("input[name=game]");for(var s=0;s<t.length;s++)if(t[s].value==JSON.parse(this.responseText)){e=t[s];break}let a=document.createElement("div");a.classList.add("alert"),a.classList.add("alert-success"),a.innerHTML="<spanÂ«<strong>Success!</strong></span>";let n=e.nextSibling;e.parentNode.replaceChild(a,n)}function showErrorMessage(e){let t=document.querySelector("header:first-of-type");console.log(t);let s=document.createElement("div");s.classList.add("alert"),s.classList.add("alert-danger"),s.classList.add("d-flex"),s.classList.add("justify-content-center"),5===Math.floor(e/100)?s.innerHTML="<span><strong>An error occurred in the server! Try again later!</strong></span>":s.innerHTML="<span><strong>Error! You cannot execute that action!</strong></span>",t.appendChild(s)}function sendLoadReviewsRequest(){sendAjaxRequest("get","/api/games/"+this.previousSibling.value.trim()+"/reviews/"+loads,null,loadReviewsRequestHandler),loads++}function loadReviewsRequestHandler(){if(200!=this.status)return void showErrorMessage(this.status);let e=JSON.parse(this.responseText),t=document.querySelector('section[id="userReviews"]');e.forEach(e=>{let s=document.createElement("div");s.classList.add("review1"),null==e.path&&(e.path="/img/avatar.png"),s.innerHTML=createReview(e),t.appendChild(s),t.appendChild(document.createElement("br"));let a=s.querySelectorAll("button.upvote");[].forEach.call(a,function(e){e.addEventListener("click",sendUpvoteReviewRequest)});let n=s.querySelectorAll("button.downvote");[].forEach.call(n,function(e){e.addEventListener("click",sendDownvoteReviewRequest)})}),clean(t)}function createReview(e){return'\n      <div class="row">\n        <div class="col-sm-8">\n          <p class="user"> <img class="avatar1" src="'+e.path+'">&ensp; '+e.username+' </p>\n        </div>\n        <div class="col-sm-4">\n          <p>\n            <div class="review-score">\n              '+function(){let t="";for(i=1;i<=e.score;i++)t+='<span class="fa fa-star checked"></span>\n';for(i=e.score;i<=5;i++)t+='<span class="fa fa-star"></span>\n';return t}()+'\n            </div>\n          </p>\n        </div>\n      </div>\n\n      <p class="review-text text-justify">'+e.content+'</p>\n\n      <div class="row">\n        <div class="col-sm-8 vote">\n          <input type="hidden" name="game" value="'+e.idgame+'">\n          <input type="hidden" name="user" value="'+e.iduser+'">\n          <button type="button" class="btn btn-info upvote"><i class="'+(null===e.type||0==e.type?"far fa-thumbs-up":"fas fa-thumbs-up")+'"></i></button>\n          <button type="button" class="btn btn-info downvote"><i class="'+(null===e.type||1==e.type?"far fa-thumbs-down":"fas fa-thumbs-down")+'"></i></button>\n          <span class="voteNumber">'+e.votes+'</span>\n        </div>\n        <div class="col-sm-4">\n          <p class="date"><span class="reviewDate"><i class="far fa-clock"></i> '+convertDate(e.creationdate)+" </span></p>\n        </div>\n      </div>\n  "}function convertDate(e){let t=e.split(/[- :]/);return t[0]+"-"+t[1]+"-"+t[2]}function addReviewForm(){let e=document.querySelector("input[name=username]").value,t=document.querySelector("input[name=user_image]").value;console.log(t),null!=t&&""!=t||(t="/img/avatar.png");let s=document.querySelector("input[name=game]").value,a=document.createElement("div");a.classList.add("review1"),a.id="addReview",a.innerHTML='<form action="/games/'+s.trim()+'/reviews" class="form-group" onsubmit="return validateReviewForm()" method="post" enctype="multipart/form-data"><div class="row"><div class="col-sm-8"><p class="user"> <img class="avatar1" src="'+t.trim()+'" alt="Your profile picture">&ensp; '+e.trim()+' </p></div><div class="col-sm-4"><p><div class="review-score"><input type="radio" class="d-none" name="score" id="score_1" value="1"><label for="score_1"><i onmouseover="colorStarHover(1)" onclick="colorStar(1)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_2" value="2"><label for="score_2"><i onmouseover="colorStarHover(2)" onclick="colorStar(2)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_3" value="3"><label for="score_3"><i onmouseover="colorStarHover(3)" onclick="colorStar(3)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_4" value="4"><label for="score_4"><i onmouseover="colorStarHover(4)" onclick="colorStar(4)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_5" value="5"><label for="score_5"><i onmouseover="colorStarHover(5)" onclick="colorStar(5)" class="fa fa-star"></i></label></div></p></div></div><p class="review-text"><textarea class="form-control" name="content" rows="5" id="gameDescription" placeholder ="Share your opinion..."></textarea> </p><div class="row"><div class="col-sm-4"><p class="date"><span class="reviewDate"><i class="far fa-clock"></i> '+(new Date).toJSON().slice(0,10).replace(/-/g,"-")+' </span></p></div><div class="col-sm-8"><input type="hidden" name="_token" value="'+document.getElementsByName("_token")[0].value+'"><p class="submitReview"><button type="submit" class="btn btn-info submit">Submit</button><button type="button" onclick="closeReviewForm()" class="btn btn-danger btn-sm cancel">Cancel</button></p></div></div></form>',document.querySelector("div.reviews div.container").appendChild(a),document.querySelector("button.addReview").classList.add("d-none")}function validateReviewForm(){let e=document.querySelector("div#addReview form");null==e&&(e=document.querySelector("div#editReview form"));let t=e.querySelector("textarea[name=content]");if(""==t.value||null==t.value)return window.alert("You must write the content of the review before submitting!"),t.focus(),!1;let s=!1,a=e.querySelectorAll("input[name=score]");for(let e=0;e<a.length;e++)1==a[e].checked&&(s=!0);return!!s||(window.alert("You must assign a score to the game before submitting!"),!1)}function closeReviewForm(){let e=document.querySelector("div#addReview");e.parentNode.removeChild(e),document.querySelector("button.addReview").classList.remove("d-none")}function closeEditReviewForm(){let e=document.querySelector("div#editReview");e.parentNode.removeChild(e),document.querySelector("button.editReview").classList.remove("d-none")}function colorStar(e){let t=document.querySelectorAll("i.fa.fa-star");for(let s=0;s<t.length;s++)t[s].parentNode.previousSibling.value<=e?(t[s].classList.add("checked"),t[s].parentNode.previousSibling.value==e&&(t[s].parentNode.previousSibling.checked=!0)):t[s].classList.remove("checked")}function colorStarHover(e){let t=document.querySelectorAll("i.fa.fa-star");for(let s=0;s<t.length;s++)t[s].parentNode.previousSibling.value<=e?t[s].style.color="orange":t[s].style.color="black"}function editReviewForm(){let e=document.querySelector("input[name=username]").value,t=document.querySelector("input[name=user_image]").value;null!=t&&""!=t||(t="/img/avatar.png");let s,a=document.querySelector("input[name=game]").value,n=document.querySelectorAll("div.user_reviews"),r="Share your opinion......",o=5;for(let t=0;t<n.length;t++)n[t].querySelector("p.user").textContent.trim()==e&&(r=n[t].querySelector("p.review-text").textContent,o=n[t].querySelector("input[name=review_score]").value,s=n[t].querySelector("p.date").textContent);let i=document.createElement("div");i.classList.add("review1"),i.id="editReview",i.innerHTML='<form action="/games/'+a.trim()+'/reviews/edit" class="form-group" onsubmit="return validateReviewForm()" method="post" enctype="multipart/form-data"><div class="row"><div class="col-sm-8"><p class="user"> <img class="avatar1" src="'+t.trim()+'" alt="Your profile picture">&ensp; '+e.trim()+' </p></div><div class="col-sm-4"><p><div class="review-score"><input type="radio" class="d-none" name="score" id="score_1" value="1"><label for="score_1"><i onmouseover="colorStarHover(1)" onclick="colorStar(1)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_2" value="2"><label for="score_2"><i onmouseover="colorStarHover(2)" onclick="colorStar(2)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_3" value="3"><label for="score_3"><i onmouseover="colorStarHover(3)" onclick="colorStar(3)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_4" value="4"><label for="score_4"><i onmouseover="colorStarHover(4)" onclick="colorStar(4)" class="fa fa-star"></i></label><input type="radio" class="d-none" name="score" id="score_5" value="5"><label for="score_5"><i onmouseover="colorStarHover(5)" onclick="colorStar(5)" class="fa fa-star"></i></label></div></p></div></div><p class="review-text"><textarea class="form-control" name="content" rows="5" id="gameDescription">'+r+'</textarea> </p><div class="row"><div class="col-sm-4"><p class="date"><span class="reviewDate"><i class="far fa-clock"></i> '+s+' </span></p></div><div class="col-sm-8"><input type="hidden" name="_token" value="'+document.getElementsByName("_token")[0].value+'"><p class="submitReview"><button type="submit" class="btn btn-info submit">Submit</button><button type="button" onclick="closeEditReviewForm()" class="btn btn-danger btn-sm cancel">Cancel</button></p></div></div></form>',document.querySelector("div.reviews div.container").appendChild(i),colorStar(o),document.querySelector("button.editReview").classList.add("d-none")}function sendUpvoteReviewRequest(){let e=this.previousSibling.previousSibling.value,t=this.previousSibling.value,s=this,a=this.nextSibling.nextSibling.nextSibling;sendAjaxRequest("post","/api/games/"+e.trim()+"/reviews/"+t.trim(),{type:1},function(){if(200==this.status){if(JSON.parse(this.responseText)){let e=s.querySelector("i"),t=s.nextSibling.querySelector("i");"far fa-thumbs-up"==e.className?(e.className="fas fa-thumbs-up",a.innerHTML=parseInt(a.innerHTML)+1,"fas fa-thumbs-down"==t.className&&(a.innerHTML=parseInt(a.innerHTML)+1)):(e.className="far fa-thumbs-up",a.innerHTML=parseInt(a.innerHTML)-1),t.className="far fa-thumbs-down"}}else showErrorMessage(this.status)})}function sendDownvoteReviewRequest(){let e=this.previousSibling.previousSibling.previousSibling.value,t=this.previousSibling.previousSibling.value,s=this,a=this.nextSibling.nextSibling;sendAjaxRequest("post","/api/games/"+e.trim()+"/reviews/"+t.trim(),{type:0},function(){if(200==this.status){if(JSON.parse(this.responseText)){let e=s.previousSibling.querySelector("i"),t=s.querySelector("i");"far fa-thumbs-down"==t.className?(t.className="fas fa-thumbs-down",a.innerHTML=parseInt(a.innerHTML)-1,"fas fa-thumbs-up"==e.className&&(a.innerHTML=parseInt(a.innerHTML)-1)):(t.className="far fa-thumbs-down",a.innerHTML=parseInt(a.innerHTML)+1),e.className="far fa-thumbs-up"}}else showErrorMessage(this.status)})}function clean(e){for(var t=0;t<e.childNodes.length;t++){var s=e.childNodes[t];8===s.nodeType||3===s.nodeType&&!/\S/.test(s.nodeValue)?(e.removeChild(s),t--):1===s.nodeType&&clean(s)}}clean(document);var loads=0;addEventListeners(),$(".custom-file-input").on("change",function(){var e=$(this).val().split("\\").pop();$(this).siblings(".custom-file-label").addClass("selected").html(e)});